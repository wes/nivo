import*as e from"react";import{useMemo as o,useCallback as r,createElement as i,Fragment as n,useRef as t,useEffect as l}from"react";import{usePropertyAccessor as a,useValueFormatter as d,useTheme as u,getRelativeCursor as c,getDistance as s,useMotionConfig as v,Container as f,useDimensions as h,bindDefs as p,SvgWrapper as m,ResponsiveWrapper as b}from"@nivo/core";import{hierarchy as y,pack as C}from"d3-hierarchy";import g from"lodash/cloneDeep";import M from"lodash/sortBy";import{useOrdinalColorScale as x,useInheritedColor as k}from"@nivo/colors";import{BasicTooltip as w,useTooltip as I}from"@nivo/tooltip";import{jsx as E,Fragment as F}from"react/jsx-runtime";import{useTransition as W,to as L,animated as R}from"@react-spring/web";function O(){return O=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},O.apply(this,arguments)}function P(e,o){if(null==e)return{};var r,i,n={},t=Object.keys(e);for(i=0;i<t.length;i++)r=t[i],o.indexOf(r)>=0||(n[r]=e[r]);return n}var B,S=function(e){var o,r=e.data,i=e.id,n=e.value,t=e.valueFormat,l=e.width,c=e.height,s=e.padding,v=e.leavesOnly,f=e.colors,h=e.colorBy,p=e.inheritColorFromParent,m=e.childColor,b=a(i),w=a(n),I=d(t),E=x(f,h),F=u(),W=k(m,F),L=g(r),R=y(L).sum(w),O=C().size([l,c]).padding(s)(R),P=v?O.leaves():O.descendants(),B=M(P,"depth"),S=null!=(o=R.value)?o:0,T=B.reduce((function(e,o){var r,i=b(o.data),n=o.value,l=100*n/S,a=o.ancestors().map((function(e){return b(e.data)}));o.parent&&(r=e.find((function(e){return e.id===b(o.parent.data)})));var d={id:i,path:a,value:n,percentage:l,formattedValue:t?I(n):l.toFixed(2)+"%",x:o.x,y:o.y,radius:o.r,color:"",data:o.data,depth:o.depth,height:o.height};return p&&r&&d.depth>1?d.color=W(r):d.color=E(d),[].concat(e,[d])}),[]);return T},T=function(e,r,i,n){return o((function(){if(!r)return e;var o=e.find((function(e){return e.id===r}));if(!o)return e;var t=Math.min(i,n)/(2*o.radius),l=i/2-o.x*t,a=n/2-o.y*t;return e.map((function(e){return O({},e,{x:e.x*t+l,y:e.y*t+a,radius:e.radius*t})}))}),[e,r,i,n])},j=function(e){var r=e.nodes,i=e.label,n=e.filter,t=e.skipRadius,l=e.textColor,d=a(i),c=u(),s=k(l,c),v=o((function(){return r.filter((function(e){return e.radius>=t})).map((function(e){return{label:d(e),textColor:s(e),node:e}}))}),[r,t,d,s]);return o((function(){return n?v.filter(n):v}),[v,n])},z=function(e,r){var i=r.onMouseEnter,n=r.onMouseMove,t=r.onMouseLeave,l=r.onClick;return o((function(){return{onMouseEnter:i?function(o){i(e,o)}:void 0,onMouseMove:n?function(o){n(e,o)}:void 0,onMouseLeave:t?function(o){t(e,o)}:void 0,onClick:l?function(o){l(e,o)}:void 0}}),[e,i,n,t,l])},H=function(e){var i=e.nodes,n=e.canvasEl,t=e.margin,l=o((function(){return M(i,"height")}),[i]);return r((function(e){if(!n.current)return null;var o=c(n.current,e),r=o[0],i=o[1];return l.find((function(e){return s(e.x,e.y,r-t.left,i-t.top)<=e.radius}))}),[n,t,l])},A=function(e){var r=e.nodes;return o((function(){return{nodes:r}}),[r])},V={id:"id",value:"value",padding:0,leavesOnly:!1,layers:["circles","labels"],colors:{scheme:"nivo"},colorBy:"depth",inheritColorFromParent:!1,childColor:{from:"color",modifiers:[["darker",.3]]},borderWidth:0,borderColor:{from:"color",modifiers:[["darker",.3]]},defs:[],fill:[],enableLabels:!1,label:"id",labelTextColor:{from:"color",modifiers:[["darker",1.6]]},labelsSkipRadius:8,isInteractive:!0,tooltip:function(e){var o=e.id,r=e.formattedValue,i=e.color;return E(w,{id:o,value:r,enableChip:!0,color:i})},animate:!0,motionConfig:"gentle",role:"img",pixelRatio:"undefined"!=typeof window&&null!=(B=window.devicePixelRatio)?B:1},D=function(e){return L([e],(function(e){return Math.max(0,e)}))},K=function(r){var n=r.nodes,t=r.borderWidth,l=r.borderColor,a=r.component,d=r.isInteractive,c=r.onMouseEnter,s=r.onMouseMove,f=r.onMouseLeave,h=r.onClick,p=r.tooltip,m=I(),b=m.showTooltipFromEvent,y=m.hideTooltip,C=o((function(){if(d)return function(e,o){b(i(p,e),o),null==c||c(e,o)}}),[d,b,p,c]),g=o((function(){if(d)return function(e,o){b(i(p,e),o),null==s||s(e,o)}}),[d,b,p,s]),M=o((function(){if(d)return function(e,o){y(),null==f||f(e,o)}}),[d,y,f]),x=o((function(){if(d)return function(e,o){null==h||h(e,o)}}),[d,h]),w=v(),L=w.animate,R=w.config,P=u(),B=k(l,P),S=o((function(){return function(e){return{enter:function(o){return{x:o.x,y:o.y,radius:0,color:o.color,borderColor:e(o),opacity:0}},update:function(o){return{x:o.x,y:o.y,radius:o.radius,color:o.color,borderColor:e(o),opacity:1}},leave:function(o){return{x:o.x,y:o.y,radius:0,color:o.color,borderColor:e(o),opacity:0}}}}(B)}),[B]),T=W(n,{keys:function(e){return e.id},initial:S.update,from:S.enter,enter:S.update,update:S.update,leave:S.leave,config:R,immediate:!L});return E(F,{children:T((function(o,r){return e.createElement(a,{key:r.id,node:r,style:O({},o,{radius:D(o.radius),borderWidth:t}),onMouseEnter:C,onMouseMove:g,onMouseLeave:M,onClick:x})}))})},q=function(e){var o=e.node,r=e.style,i=e.onMouseEnter,n=e.onMouseMove,t=e.onMouseLeave,l=e.onClick,a=z(o,{onMouseEnter:i,onMouseMove:n,onMouseLeave:t,onClick:l});return E(R.circle,{cx:r.x,cy:r.y,r:r.radius,fill:o.fill||r.color,stroke:r.borderColor,strokeWidth:r.borderWidth,opacity:r.opacity,onMouseEnter:a.onMouseEnter,onMouseMove:a.onMouseMove,onMouseLeave:a.onMouseLeave,onClick:a.onClick},o.id)},G=function(e){var r=e.nodes,n=e.label,t=e.filter,l=e.skipRadius,a=e.textColor,d=e.component,u=v(),c=u.animate,s=u.config,f=j({nodes:r,label:n,filter:t,skipRadius:l,textColor:a}),h=o((function(){return{enter:function(e){return{x:e.node.x,y:e.node.y,radius:e.node.radius,textColor:e.textColor,opacity:0}},update:function(e){return{x:e.node.x,y:e.node.y,radius:e.node.radius,textColor:e.textColor,opacity:1}},leave:function(e){return{x:e.node.x,y:e.node.y,radius:e.node.radius,textColor:e.textColor,opacity:0}}}}),[]),p=W(f,{keys:function(e){return e.node.id},initial:h.update,from:h.enter,enter:h.update,update:h.update,leave:h.leave,config:s,immediate:!c});return E(F,{children:p((function(e,o){return i(d,{key:o.node.id,label:o.label,style:O({},e,{radius:D(e.radius)}),node:o.node})}))})},J=function(e){var o=e.node,r=e.label,i=e.style,n=u();return E(R.text,{x:i.x,y:i.y,textAnchor:"middle",dominantBaseline:"central",style:O({},n.labels.text,{fill:i.textColor,opacity:i.opacity,pointerEvents:"none"}),children:r},o.id)},N=["theme","isInteractive","animate","motionConfig","renderWrapper"],Q=function(e){var r=e.data,t=e.id,l=void 0===t?V.id:t,a=e.value,d=void 0===a?V.value:a,u=e.valueFormat,c=e.width,s=e.height,v=e.margin,f=e.padding,b=void 0===f?V.padding:f,y=e.leavesOnly,C=void 0===y?V.leavesOnly:y,g=e.colors,M=void 0===g?V.colors:g,x=e.colorBy,k=void 0===x?V.colorBy:x,w=e.inheritColorFromParent,I=void 0===w?V.inheritColorFromParent:w,F=e.childColor,W=void 0===F?V.childColor:F,L=e.borderWidth,R=void 0===L?V.borderWidth:L,O=e.borderColor,P=void 0===O?V.borderColor:O,B=e.circleComponent,j=void 0===B?q:B,z=e.defs,H=void 0===z?V.defs:z,D=e.fill,N=void 0===D?V.fill:D,Q=e.enableLabels,U=void 0===Q?V.enableLabels:Q,X=e.label,Y=void 0===X?V.label:X,Z=e.labelsFilter,$=e.labelsSkipRadius,_=void 0===$?V.labelsSkipRadius:$,ee=e.labelTextColor,oe=void 0===ee?V.labelTextColor:ee,re=e.labelComponent,ie=void 0===re?J:re,ne=e.layers,te=void 0===ne?V.layers:ne,le=e.isInteractive,ae=e.onMouseEnter,de=e.onMouseMove,ue=e.onMouseLeave,ce=e.onClick,se=e.tooltip,ve=void 0===se?V.tooltip:se,fe=e.zoomedId,he=e.role,pe=void 0===he?V.role:he,me=h(c,s,v),be=me.outerWidth,ye=me.outerHeight,Ce=me.margin,ge=me.innerWidth,Me=me.innerHeight,xe=S({data:r,id:l,value:d,valueFormat:u,width:ge,height:Me,padding:b,leavesOnly:C,colors:M,colorBy:k,inheritColorFromParent:I,childColor:W}),ke=T(xe,fe,ge,Me),we=o((function(){return p(H,ke,N,{targetKey:"fill"})}),[H,ke,N]),Ie={circles:null,labels:null};te.includes("circles")&&(Ie.circles=E(K,{nodes:ke,borderWidth:R,borderColor:P,isInteractive:le,onMouseEnter:ae,onMouseMove:de,onMouseLeave:ue,onClick:ce,component:j,tooltip:ve},"circles")),U&&te.includes("labels")&&(Ie.labels=E(G,{nodes:ke,label:Y,filter:Z,skipRadius:_,textColor:oe,component:ie},"labels"));var Ee=A({nodes:xe});return E(m,{width:be,height:ye,margin:Ce,defs:we,role:pe,children:te.map((function(e,o){return void 0!==Ie[e]?Ie[e]:"function"==typeof e?E(n,{children:i(e,Ee)},o):null}))})},U=function(e){var o=e.theme,r=e.isInteractive,i=void 0===r?V.isInteractive:r,n=e.animate,t=void 0===n?V.animate:n,l=e.motionConfig,a=void 0===l?V.motionConfig:l,d=e.renderWrapper,u=P(e,N);return E(f,{isInteractive:i,animate:t,motionConfig:a,renderWrapper:d,theme:o,children:E(Q,O({isInteractive:i},u))})},X=function(e){return E(b,{children:function(o){var r=o.width,i=o.height;return E(U,O({width:r,height:i},e))}})},Y=function(e,o){return L([e,o],(function(e,o){return e-o}))},Z=function(e){return L([e],(function(e){return 2*e}))},$=function(e){var o,r,i=e.node,n=e.style,t=e.onMouseEnter,l=e.onMouseMove,a=e.onMouseLeave,d=e.onClick,u=Z(n.radius),c=z(i,{onMouseEnter:t,onMouseMove:l,onMouseLeave:a,onClick:d});return E(R.div,{style:{position:"absolute",top:Y(n.y,n.radius),left:Y(n.x,n.radius),height:u,width:u,borderRadius:n.radius,backgroundColor:n.color,borderWidth:(o=n.borderWidth,r=n.radius,L([r],(function(e){return Math.min(o,e)}))),borderStyle:"solid",borderColor:n.borderColor,boxSizing:"border-box"},onMouseEnter:c.onMouseEnter,onMouseMove:c.onMouseMove,onMouseLeave:c.onMouseLeave,onClick:c.onClick})},_=function(e){var o=e.node,r=e.label,i=e.style,n=u(),t=Z(i.radius);return E(R.div,{style:O({},n.labels.text,{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",top:Y(i.y,i.radius),left:Y(i.x,i.radius),width:t,height:t,color:i.textColor,opacity:i.opacity,pointerEvents:"none"}),children:r},o.id)},ee=["theme","isInteractive","animate","motionConfig"],oe=function(e){var o=e.data,r=e.id,t=void 0===r?V.id:r,l=e.value,a=void 0===l?V.value:l,d=e.valueFormat,u=e.width,c=e.height,s=e.margin,v=e.padding,f=void 0===v?V.padding:v,p=e.leavesOnly,m=void 0===p?V.leavesOnly:p,b=e.colors,y=void 0===b?V.colors:b,C=e.colorBy,g=void 0===C?V.colorBy:C,M=e.inheritColorFromParent,x=void 0===M?V.inheritColorFromParent:M,k=e.childColor,w=void 0===k?V.childColor:k,I=e.borderWidth,F=void 0===I?V.borderWidth:I,W=e.borderColor,L=void 0===W?V.borderColor:W,R=e.circleComponent,O=void 0===R?$:R,P=e.enableLabels,B=void 0===P?V.enableLabels:P,j=e.label,z=void 0===j?V.label:j,H=e.labelsFilter,D=e.labelsSkipRadius,q=void 0===D?V.labelsSkipRadius:D,J=e.labelTextColor,N=void 0===J?V.labelTextColor:J,Q=e.labelComponent,U=void 0===Q?_:Q,X=e.layers,Y=void 0===X?V.layers:X,Z=e.isInteractive,ee=e.onMouseEnter,oe=e.onMouseMove,re=e.onMouseLeave,ie=e.onClick,ne=e.tooltip,te=void 0===ne?V.tooltip:ne,le=e.zoomedId,ae=e.role,de=void 0===ae?V.role:ae,ue=h(u,c,s),ce=ue.outerWidth,se=ue.outerHeight,ve=ue.margin,fe=ue.innerWidth,he=ue.innerHeight,pe=S({data:o,id:t,value:a,valueFormat:d,width:fe,height:he,padding:f,leavesOnly:m,colors:y,colorBy:g,inheritColorFromParent:x,childColor:w}),me=T(pe,le,fe,he),be={circles:null,labels:null};Y.includes("circles")&&(be.circles=E(K,{nodes:me,borderWidth:F,borderColor:L,isInteractive:Z,onMouseEnter:ee,onMouseMove:oe,onMouseLeave:re,onClick:ie,component:O,tooltip:te},"circles")),B&&Y.includes("labels")&&(be.labels=E(G,{nodes:me,label:z,filter:H,skipRadius:q,textColor:N,component:U},"labels"));var ye=A({nodes:pe});return E("div",{role:de,style:{position:"relative",overflow:"hidden",width:ce,height:se},children:E("div",{style:{position:"absolute",top:ve.top,left:ve.left},children:Y.map((function(e,o){return void 0!==be[e]?be[e]:"function"==typeof e?E(n,{children:i(e,ye)},o):null}))})})},re=function(e){var o=e.theme,r=e.isInteractive,i=void 0===r?V.isInteractive:r,n=e.animate,t=void 0===n?V.animate:n,l=e.motionConfig,a=void 0===l?V.motionConfig:l,d=P(e,ee);return E(f,{isInteractive:i,animate:t,motionConfig:a,theme:o,children:E(oe,O({isInteractive:i},d))})},ie=function(e){return E(b,{children:function(o){var r=o.width,i=o.height;return E(re,O({width:r,height:i},e))}})},ne=["isInteractive","theme"],te=function(e){var o=e.data,n=e.id,a=void 0===n?V.id:n,d=e.value,c=void 0===d?V.value:d,s=e.valueFormat,v=e.width,f=e.height,p=e.margin,m=e.padding,b=void 0===m?V.padding:m,y=e.leavesOnly,C=void 0===y?V.leavesOnly:y,g=e.colors,M=void 0===g?V.colors:g,x=e.colorBy,w=void 0===x?V.colorBy:x,F=e.inheritColorFromParent,W=void 0===F?V.inheritColorFromParent:F,L=e.childColor,R=void 0===L?V.childColor:L,O=e.borderWidth,P=void 0===O?V.borderWidth:O,B=e.borderColor,z=void 0===B?V.borderColor:B,A=e.enableLabels,D=void 0===A?V.enableLabels:A,K=e.label,q=void 0===K?V.label:K,G=e.labelsFilter,J=e.labelsSkipRadius,N=void 0===J?V.labelsSkipRadius:J,Q=e.labelTextColor,U=void 0===Q?V.labelTextColor:Q,X=e.isInteractive,Y=e.onMouseMove,Z=e.onClick,$=e.tooltip,_=void 0===$?V.tooltip:$,ee=e.zoomedId,oe=e.role,re=void 0===oe?V.role:oe,ie=e.pixelRatio,ne=void 0===ie?V.pixelRatio:ie,te=t(null),le=u(),ae=h(v,f,p),de=ae.margin,ue=ae.innerWidth,ce=ae.innerHeight,se=ae.outerWidth,ve=ae.outerHeight,fe=S({data:o,id:a,value:c,valueFormat:s,width:ue,height:ce,padding:b,leavesOnly:C,colors:M,colorBy:w,inheritColorFromParent:W,childColor:R}),he=T(fe,ee,ue,ce),pe=j({nodes:he,label:q,filter:G,skipRadius:N,textColor:U}),me=k(z,le);l((function(){if(te.current){te.current.width=se*ne,te.current.height=ve*ne;var e=te.current.getContext("2d");e.scale(ne,ne),e.fillStyle=le.background,e.fillRect(0,0,se,ve),e.save(),e.translate(de.left,de.top),he.forEach((function(o){P>0&&(e.strokeStyle=me(o),e.lineWidth=P),e.beginPath(),e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.fillStyle=o.color,e.fill(),P>0&&e.stroke()})),D&&(e.textAlign="center",e.textBaseline="middle",e.font=le.labels.text.fontSize+"px "+le.labels.text.fontFamily,pe.forEach((function(o){e.fillStyle=o.textColor,e.fillText(""+o.label,o.node.x,o.node.y)})))}}),[te,ue,ce,se,ve,de.top,de.left,le,ne,he,D,pe,P,me]);var be=H({nodes:he,canvasEl:te,margin:de}),ye=I(),Ce=ye.showTooltipFromEvent,ge=ye.hideTooltip,Me=r((function(e){var o=be(e);o?(null==Y||Y(o,e),Ce(i(_,o),e)):ge()}),[be,Ce,_,ge]),xe=r((function(){ge()}),[ge]),ke=r((function(e){if(Z){var o=be(e);o&&Z(o,e)}}),[be,Z]);return E("canvas",{ref:te,width:se*ne,height:ve*ne,style:{width:se,height:ve,cursor:X?"auto":"normal"},role:re,onMouseEnter:X?Me:void 0,onMouseMove:X?Me:void 0,onMouseLeave:X?xe:void 0,onClick:X?ke:void 0})},le=function(e){var o=e.isInteractive,r=void 0===o?V.isInteractive:o,i=e.theme,n=P(e,ne);return E(f,{isInteractive:r,theme:i,children:E(te,O({isInteractive:r},n))})},ae=function(e){return E(b,{children:function(o){var r=o.width,i=o.height;return E(le,O({width:r,height:i},e))}})};export{U as CirclePacking,le as CirclePackingCanvas,re as CirclePackingHtml,oe as InnerCirclePackingHtml,X as ResponsiveCirclePacking,ae as ResponsiveCirclePackingCanvas,ie as ResponsiveCirclePackingHtml,V as defaultProps,S as useCirclePacking,j as useCirclePackingLabels,A as useCirclePackingLayerContext,T as useCirclePackingZoom,H as useMouseCircleDetection,z as useNodeMouseHandlers};
//# sourceMappingURL=nivo-circle-packing.es.js.map
