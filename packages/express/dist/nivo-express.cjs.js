"use strict";var t=require("express"),e=require("uuid"),r=require("lodash/forOwn"),a=require("@nivo/static"),n=require("lodash/omit");function s(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})),e.default=t,Object.freeze(e)}var o=s(e),u={},i=t.Router();i.get("/",(function(t,e){e.status(200).json({samples:Object.keys(a.samples).map((function(e){return t.protocol+"://"+t.get("host")+t.originalUrl+"/samples/"+e+".svg"}))})})),r(a.chartsMapping,(function(t,e){var r=t.schema;i.post("/charts/"+e,function(t,e){void 0===e&&(e={});var r=e.omit;return function(e,a,s){var o=e.body;n&&(o=n(o,r));try{e.payload=t.validate(o,{abortEarly:!0,convert:!0}),s()}catch(t){return a.status(400).json({errors:t.details.map((function(t){var e=t.message,r=t.path;return e+(r?" ("+r+")":"")}))})}}}(r),(function(t,r){var a,n=t.payload,s=o.v4(),i=t.protocol+"://"+t.get("host")+"/r/"+s;a={type:e,props:n,url:i},u[s]=a,r.status(201).json({id:s,url:i})}))})),i.get("/r/:id",(function(t,e){var r,n=t.params.id,s=(r=t.params.id,u[r]);if(!s)return e.set("Content-Type","text/plain").status(404).send('no chart found for id "'+n+'"');var o=a.renderChart(s,t.query);e.set("Content-Type","image/svg+xml").status(200).send(o)})),r(a.samples,(function(t,e){i.get("/samples/"+e+".svg",(function(e,r){var n=a.renderChart(t,e.query);r.set("Content-Type","image/svg+xml").status(200).send(n)}))})),exports.nivo=i;
//# sourceMappingURL=nivo-express.cjs.js.map
