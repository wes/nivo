import{useMemo as e,useRef as o,useEffect as t,useCallback as i,createElement as r,Fragment as n}from"react";import{useValueFormatter as a,useTheme as d,bindDefs as l,useMotionConfig as c,Container as s,useDimensions as u,SvgWrapper as v,ResponsiveWrapper as f,getRelativeCursor as p,isCursorInRect as h}from"@nivo/core";import{BoxLegendSvg as m,renderLegendToCanvas as g}from"@nivo/legends";import{animated as y,useTransition as b}from"@react-spring/web";import{jsx as C,Fragment as M}from"react/jsx-runtime";import{BasicTooltip as I,useTooltip as w}from"@nivo/tooltip";import{line as x,curveLinearClosed as D}from"d3-shape";import{useOrdinalColorScale as k,useInheritedColor as W}from"@nivo/colors";import{generateGrid as L,getCellsPolygons as P}from"@nivo/grid";import{roundedRect as E}from"@nivo/canvas";function O(){return O=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},O.apply(this,arguments)}function R(e,o){if(null==e)return{};var t,i,r={},n=Object.keys(e);for(i=0;i<n.length;i++)t=n[i],o.indexOf(t)>=0||(r[t]=e[t]);return r}var S,B={hiddenIds:[],fillDirection:"top",padding:0,colors:{scheme:"nivo"},emptyColor:"#cccccc",emptyOpacity:1,borderRadius:0,borderWidth:0,borderColor:{from:"color",modifiers:[["darker",1]]},isInteractive:!0,tooltip:function(e){var o=e.data;return C(I,{id:o.label,value:o.formattedValue,enableChip:!0,color:o.color})},role:"img",animate:!0,motionConfig:"gentle"},H=O({},B,{layers:["cells","areas","legends"],cellComponent:function(e){var o=e.cell,t=e.animatedProps,i=e.borderRadius,r=e.borderWidth,n=e.testIdPrefix;return C(y.rect,{x:t.x,y:t.y,width:t.size,height:t.size,rx:i,ry:i,opacity:t.opacity,fill:o.fill||t.color,stroke:t.borderColor,strokeWidth:r,"data-test-id":n?n+".cell_"+o.key:void 0})},defs:[],fill:[],legends:[],motionStagger:0}),F=O({},B,{layers:["cells","areas"],cellComponent:function(e){var o=e.cell,t=e.animatedProps,i=e.borderRadius,r=e.borderWidth,n=e.testIdPrefix;return C(y.div,{style:{position:"absolute",top:t.y,left:t.x,width:t.size,height:t.size,background:t.color,opacity:t.opacity,boxSizing:"content-box",borderStyle:"solid",borderRadius:i+"px",borderWidth:r+"px",borderColor:t.borderColor},"data-test-id":n?""+n+o.key:void 0})},defs:[],fill:[],legends:[],motionStagger:0}),j=O({},B,{legends:[],pixelRatio:"undefined"!=typeof window&&null!=(S=window.devicePixelRatio)?S:1}),z=function(e){return void 0!==e.data},A=function(i){var r=i.width,n=i.height,c=i.data,s=i.hiddenIds,u=i.valueFormat,v=i.total,f=i.rows,p=i.columns,h=i.fillDirection,m=void 0===h?B.fillDirection:h,g=i.colors,y=void 0===g?B.colors:g,b=i.emptyColor,C=void 0===b?B.emptyColor:b,M=i.emptyOpacity,I=void 0===M?B.emptyOpacity:M,w=i.borderColor,x=void 0===w?B.borderColor:w,D=i.forwardLegendData,E=i.defs,R=void 0===E?[]:E,S=i.fill,H=void 0===S?[]:S,F=a(u),j=k(y,"id"),A=d(),_=W(x,A),G=v/(f*p),T=e((function(){var e=0,o=[];return c.forEach((function(t,i){var r=s.includes(t.id),n=e,a=n;r||(a=n+Math.round(t.value/G)),e=a;var d=j(t),l={id:t.id,isHidden:r,label:t.label,value:t.value,formattedValue:F(t.value),groupIndex:i,startAt:n,endAt:a,color:d,borderColor:d,data:t,polygons:[]};l.borderColor=_(l),o.push(l)})),o}),[c,s,G,F,j,_]),V=e((function(){return l(R,T,H)}),[T,R,H]),q=e((function(){return function(e){var o=e.width,t=e.height,i=e.rows,r=e.columns,n=e.fillDirection,a=e.emptyColor,d=e.emptyOpacity,l=(0,e.getBorderColor)({color:a});return L({width:o,height:t,rows:i,columns:r,fillDirection:n,square:!0,extend:function(e,o){return O({},e,{x:o[0]+e.x,y:o[1]+e.y,color:a,opacity:d,borderColor:l})}}).cells}({width:r,height:n,rows:f,columns:p,fillDirection:m,emptyColor:C,emptyOpacity:I,getBorderColor:_})}),[r,n,f,p,m,C,I,_]),J=e((function(){return function(e,o){var t=e.map((function(e){return O({},e)}));return o.forEach((function(e){for(var o=e.startAt;o<e.endAt;o++){var i=t[o];if(void 0!==i){var r=i;r.data=e,r.color=e.color,r.opacity=1,r.borderColor=e.borderColor,e.fill&&(r.fill=e.fill)}}}),[]),t}(q,T)}),[q,T]),K=e((function(){return function(e){for(var o=e.reduce((function(e,o){return(e[o.data.id]=e[o.data.id]||[]).push(o),e}),{}),t={},i=0,r=Object.entries(o);i<r.length;i++){var n=r[i],a=n[0],d=n[1];t[a]=P(d)}return t}(J.filter(z))}),[J]);T.forEach((function(e){e.id in K&&(e.polygons=K[e.id])}));var N=e((function(){var e=T.map((function(e){return{id:e.id,label:e.label,color:e.color,data:e}}));return["top","left"].includes(m)&&e.reverse(),e}),[T,m]),Q=o(D);return t((function(){"function"==typeof Q.current&&Q.current(N)}),[Q,N]),{cells:J,computedData:T,legendData:N,getBorderColor:_,boundDefs:V}},_=function(){return e((function(){return x().curve(D)}),[])},G=function(e,o,t){var n=o.onMouseEnter,a=o.onMouseMove,d=o.onMouseLeave,l=o.onClick,c=w(),s=c.showTooltipFromEvent,u=c.hideTooltip;return{handleMouseEnter:i((function(o){s(r(t,{data:e}),o),null==n||n(e,o)}),[s,e,n]),handleMouseMove:i((function(o){s(r(t,{data:e}),o),null==a||a(e,o)}),[s,e,a]),handleMouseLeave:i((function(o){u(),null==d||d(e,o)}),[u,e,d]),handleClick:i((function(o){u(),null==l||l(e,o)}),[u,e,l])}},T=function(o){var t=o.cells,i=o.padding,r=o.motionStagger,n=c(),a=n.animate,d=n.config,l=e((function(){return function(e){return{x:e.x+i/2,y:e.y+i/2,color:e.color,size:e.width-i,opacity:e.opacity,borderColor:e.borderColor}}}),[i]);return b(t,{keys:function(e){return e.key},initial:l,enter:l,update:l,trail:a?r:void 0,config:d,immediate:!a})},V=function(o){var t=o.cells,i=o.computedData;return e((function(){return{cells:t,computedData:i}}),[t,i])},q=function(e){var o=e.cells,t=e.cellComponent,i=e.padding,n=e.borderRadius,a=e.borderWidth,d=e.motionStagger,l=e.testIdPrefix,c=T({cells:o,padding:i,motionStagger:d});return C("g",{children:c((function(e,o){return r(t,{key:o.key,cell:o,padding:i,animatedProps:e,borderRadius:n,borderWidth:a,testIdPrefix:l})}))})},J=function(e){var o=e.data,t=e.pathGenerator,i=e.isInteractive,r=e.onMouseEnter,n=e.onMouseMove,a=e.onMouseLeave,d=e.onClick,l=e.tooltip,c=e.testIdPrefix,s=G(o,{onMouseEnter:r,onMouseMove:n,onMouseLeave:a,onClick:d},l),u=s.handleMouseEnter,v=s.handleMouseMove,f=s.handleMouseLeave,p=s.handleClick;return C(M,{children:o.polygons.map((function(e,r){return C("path",{d:t(e),fill:"#000000",fillOpacity:0,onMouseEnter:i?u:void 0,onMouseMove:i?v:void 0,onMouseLeave:i?f:void 0,onClick:i?p:void 0,"data-test-id":c?c+".area_"+o.id+".polygon_"+r:void 0},r)}))})},K=function(e){var o=e.data,t=e.isInteractive,i=e.onMouseEnter,r=e.onMouseMove,n=e.onMouseLeave,a=e.onClick,d=e.tooltip,l=e.testIdPrefix,c=_();return C("g",{children:o.map((function(e){return e.isHidden?null:C(J,{data:e,pathGenerator:c,isInteractive:t,onMouseEnter:i,onMouseMove:r,onMouseLeave:n,onClick:a,tooltip:d,testIdPrefix:l},e.id)}))})},N=["isInteractive","animate","motionConfig","theme","renderWrapper"],Q=function(e){var o=e.width,t=e.height,i=e.margin,a=e.data,d=e.valueFormat,l=e.total,c=e.rows,s=e.columns,f=e.fillDirection,p=void 0===f?H.fillDirection:f,h=e.padding,g=void 0===h?H.padding:h,y=e.hiddenIds,b=void 0===y?H.hiddenIds:y,M=e.layers,I=void 0===M?H.layers:M,w=e.cellComponent,x=void 0===w?H.cellComponent:w,D=e.colors,k=void 0===D?H.colors:D,W=e.emptyColor,L=void 0===W?H.emptyColor:W,P=e.emptyOpacity,E=void 0===P?H.emptyOpacity:P,R=e.borderRadius,S=void 0===R?H.borderRadius:R,B=e.borderWidth,F=void 0===B?H.borderWidth:B,j=e.borderColor,z=void 0===j?H.borderColor:j,_=e.defs,G=void 0===_?H.defs:_,T=e.fill,J=void 0===T?H.fill:T,N=e.isInteractive,Q=void 0===N?H.isInteractive:N,U=e.onMouseEnter,X=e.onMouseMove,Y=e.onMouseLeave,Z=e.onClick,$=e.tooltip,ee=void 0===$?H.tooltip:$,oe=e.forwardLegendData,te=e.legends,ie=void 0===te?H.legends:te,re=e.motionStagger,ne=void 0===re?H.motionStagger:re,ae=e.role,de=void 0===ae?H.role:ae,le=e.ariaLabel,ce=e.ariaLabelledBy,se=e.ariaDescribedBy,ue=e.testIdPrefix,ve=u(o,t,i),fe=ve.outerWidth,pe=ve.outerHeight,he=ve.margin,me=ve.innerWidth,ge=ve.innerHeight,ye=A({width:me,height:ge,data:a,hiddenIds:b,valueFormat:d,total:l,rows:c,columns:s,fillDirection:p,colors:k,emptyColor:L,emptyOpacity:E,borderColor:z,forwardLegendData:oe,defs:G,fill:J}),be=ye.cells,Ce=ye.legendData,Me=ye.computedData,Ie=ye.boundDefs,we={cells:null,areas:null,legends:null};I.includes("cells")&&(we.cells=C(q,{cells:be,cellComponent:x,padding:g,borderRadius:S,borderWidth:F,motionStagger:ne,testIdPrefix:ue},"cells")),I.includes("areas")&&(we.areas=C(K,{data:Me,isInteractive:Q,onMouseEnter:U,onMouseMove:X,onMouseLeave:Y,onClick:Z,tooltip:ee,testIdPrefix:ue},"areas")),I.includes("legends")&&(we.legends=C("g",{children:ie.map((function(e,i){return C(m,O({},e,{containerWidth:o,containerHeight:t,data:Ce}),i)}))},"legends"));var xe=V({cells:be,computedData:Me});return C(v,{width:fe,height:pe,margin:he,defs:Ie,role:de,ariaLabel:le,ariaLabelledBy:ce,ariaDescribedBy:se,children:I.map((function(e,o){var t;return"function"==typeof e?C(n,{children:r(e,xe)},o):null!=(t=null==we?void 0:we[e])?t:null}))})},U=function(e){var o=e.isInteractive,t=void 0===o?H.isInteractive:o,i=e.animate,r=void 0===i?H.animate:i,n=e.motionConfig,a=void 0===n?H.motionConfig:n,d=e.theme,l=e.renderWrapper,c=R(e,N);return C(s,{animate:r,isInteractive:t,motionConfig:a,renderWrapper:l,theme:d,children:C(Q,O({isInteractive:t},c))})},X=function(e){return C(f,{children:function(o){var t=o.width,i=o.height;return C(U,O({width:t,height:i},e))}})},Y=function(e){var o=e.cells,t=e.cellComponent,i=e.padding,n=e.borderRadius,a=e.borderWidth,d=e.motionStagger,l=e.testIdPrefix,c=e.margin,s=T({cells:o,padding:i,motionStagger:d});return C("div",{style:{position:"absolute",top:c.top,left:c.left},children:s((function(e,o){return r(t,{key:o.key,cell:o,padding:i,animatedProps:e,borderRadius:n,borderWidth:a,testIdPrefix:l})}))})},Z=function(e){var o=e.data,t=e.pathGenerator,i=e.isInteractive,r=e.onMouseEnter,n=e.onMouseMove,a=e.onMouseLeave,d=e.onClick,l=e.tooltip,c=e.testIdPrefix,s=G(o,{onMouseEnter:r,onMouseMove:n,onMouseLeave:a,onClick:d},l),u=s.handleMouseEnter,v=s.handleMouseMove,f=s.handleMouseLeave,p=s.handleClick;return C(M,{children:o.polygons.map((function(e,r){return C("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"transparent",clipPath:"path('"+t(e)+"')"},onMouseEnter:i?u:void 0,onMouseMove:i?v:void 0,onMouseLeave:i?f:void 0,onClick:i?p:void 0,"data-test-id":c?c+".area_"+o.id+".polygon_"+r:void 0},r)}))})},$=function(e){var o=e.data,t=e.margin,i=e.isInteractive,r=e.onMouseEnter,n=e.onMouseMove,a=e.onMouseLeave,d=e.onClick,l=e.tooltip,c=e.testIdPrefix,s=_();return C("div",{style:{position:"absolute",top:t.top,left:t.left,width:"100%",height:"100%"},children:o.map((function(e){return e.isHidden?null:C(Z,{data:e,pathGenerator:s,isInteractive:i,onMouseEnter:r,onMouseMove:n,onMouseLeave:a,onClick:d,tooltip:l,testIdPrefix:c},e.id)}))})},ee=["isInteractive","animate","motionConfig","theme","renderWrapper"],oe=function(e){var o=e.width,t=e.height,i=e.margin,a=e.data,d=e.valueFormat,l=e.total,c=e.rows,s=e.columns,v=e.fillDirection,f=void 0===v?F.fillDirection:v,p=e.hiddenIds,h=void 0===p?F.hiddenIds:p,m=e.padding,g=void 0===m?F.padding:m,y=e.layers,b=void 0===y?F.layers:y,M=e.cellComponent,I=void 0===M?F.cellComponent:M,w=e.colors,x=void 0===w?F.colors:w,D=e.emptyColor,k=void 0===D?F.emptyColor:D,W=e.emptyOpacity,L=void 0===W?F.emptyOpacity:W,P=e.borderRadius,E=void 0===P?F.borderRadius:P,O=e.borderWidth,R=void 0===O?F.borderWidth:O,S=e.borderColor,B=void 0===S?F.borderColor:S,H=e.isInteractive,j=void 0===H?F.isInteractive:H,z=e.onMouseEnter,_=e.onMouseMove,G=e.onMouseLeave,T=e.onClick,q=e.tooltip,J=void 0===q?F.tooltip:q,K=e.forwardLegendData,N=e.motionStagger,Q=void 0===N?F.motionStagger:N,U=e.role,X=void 0===U?F.role:U,Z=e.ariaLabel,ee=e.ariaLabelledBy,oe=e.ariaDescribedBy,te=e.testIdPrefix,ie=u(o,t,i),re=ie.outerWidth,ne=ie.outerHeight,ae=ie.margin,de=ie.innerWidth,le=ie.innerHeight,ce=A({width:de,height:le,data:a,hiddenIds:h,valueFormat:d,total:l,rows:c,columns:s,fillDirection:f,colors:x,emptyColor:k,emptyOpacity:L,borderColor:B,forwardLegendData:K}),se=ce.cells,ue=ce.computedData,ve={cells:null,areas:null};b.includes("cells")&&(ve.cells=C(Y,{cells:se,cellComponent:I,padding:g,margin:ae,borderRadius:E,borderWidth:R,motionStagger:Q,testIdPrefix:te},"cells")),b.includes("areas")&&(ve.areas=C($,{data:ue,margin:ae,isInteractive:j,onMouseEnter:z,onMouseMove:_,onMouseLeave:G,onClick:T,tooltip:J,testIdPrefix:te},"areas"));var fe=V({cells:se,computedData:ue});return C("div",{style:{position:"relative",width:re,height:ne},role:X,"aria-label":Z,"aria-labelledby":ee,"aria-describedby":oe,children:b.map((function(e,o){var t;return"function"==typeof e?C(n,{children:r(e,fe)},o):null!=(t=null==ve?void 0:ve[e])?t:null}))})},te=function(e){var o=e.isInteractive,t=void 0===o?F.isInteractive:o,i=e.animate,r=void 0===i?F.animate:i,n=e.motionConfig,a=void 0===n?F.motionConfig:n,d=e.theme,l=e.renderWrapper,c=R(e,ee);return C(s,{animate:r,isInteractive:t,motionConfig:a,renderWrapper:l,theme:d,children:C(oe,O({isInteractive:t},c))})},ie=function(e){return C(f,{children:function(o){var t=o.width,i=o.height;return C(te,O({width:t,height:i},e))}})},re=["theme","isInteractive","animate","motionConfig","renderWrapper"],ne=function(e,o,t,i){return e.find((function(e){return h(o.left+e.x,o.top+e.y,e.width,e.height,t,i)}))},ae=function(e){var n=e.width,a=e.height,l=e.margin,c=e.data,s=e.valueFormat,v=e.total,f=e.rows,h=e.columns,m=e.fillDirection,y=void 0===m?j.fillDirection:m,b=e.hiddenIds,M=void 0===b?j.hiddenIds:b,I=e.padding,x=void 0===I?j.padding:I,D=e.colors,k=void 0===D?j.colors:D,W=e.emptyColor,L=void 0===W?j.emptyColor:W,P=e.emptyOpacity,R=void 0===P?j.emptyOpacity:P,S=e.borderRadius,B=void 0===S?j.borderRadius:S,H=e.borderWidth,F=void 0===H?j.borderWidth:H,_=e.borderColor,G=void 0===_?j.borderColor:_,T=e.isInteractive,V=void 0===T?j.isInteractive:T,q=e.onMouseMove,J=e.onClick,K=e.tooltip,N=void 0===K?j.tooltip:K,Q=e.forwardLegendData,U=e.legends,X=void 0===U?j.legends:U,Y=e.role,Z=void 0===Y?j.role:Y,$=e.ariaLabel,ee=e.ariaLabelledBy,oe=e.ariaDescribedBy,te=e.pixelRatio,ie=void 0===te?j.pixelRatio:te,re=o(null),ae=u(n,a,l),de=ae.margin,le=ae.innerWidth,ce=ae.innerHeight,se=ae.outerWidth,ue=ae.outerHeight,ve=A({width:le,height:ce,data:c,hiddenIds:M,valueFormat:s,total:v,rows:f,columns:h,fillDirection:y,colors:k,emptyColor:L,emptyOpacity:R,borderColor:G,forwardLegendData:Q}),fe=ve.cells,pe=ve.legendData,he=d();t((function(){if(null!==re.current){var e=re.current.getContext("2d");null!==e&&(re.current.width=se*ie,re.current.height=ue*ie,e.scale(ie,ie),e.fillStyle=he.background,e.fillRect(0,0,se,ue),e.translate(de.left,de.top),fe.forEach((function(o){e.save(),e.fillStyle=o.color,e.globalAlpha=o.opacity;var t=o.x+x/2,i=o.y+x/2,r=o.width-x,n=o.height-x;e.beginPath(),E(e,t,i,r,n,B),e.fill(),F>0&&(e.strokeStyle=o.borderColor,e.lineWidth=F,e.beginPath(),E(e,t,i,r,n,B),e.stroke()),e.restore()})),X.forEach((function(o){g(e,O({},o,{data:pe,containerWidth:n,containerHeight:a,theme:he}))})))}}),[re,de,se,ue,fe,x,B,F,he,n,a,ie,X,pe]);var me=w(),ge=me.showTooltipFromEvent,ye=me.hideTooltip,be=i((function(e){if(null!==re.current){var o=p(re.current,e),t=o[0],i=o[1],n=ne(fe,de,t,i);void 0!==n&&z(n)?(ge(r(N,{data:n.data}),e,"top"),null==q||q(n.data,e)):ye()}}),[re,fe,de,ge,ye,N,q]),Ce=i((function(){ye()}),[ye]),Me=i((function(e){if(J&&null!==re.current){var o=p(re.current,e),t=o[0],i=o[1],r=ne(fe,de,t,i);void 0!==r&&z(r)&&J(r.data,e)}}),[re,fe,de,J]);return C("canvas",{ref:re,width:se*ie,height:ue*ie,style:{width:se,height:ue},onMouseEnter:V?be:void 0,onMouseMove:V?be:void 0,onMouseLeave:V?Ce:void 0,onClick:V?Me:void 0,role:Z,"aria-label":$,"aria-labelledby":ee,"aria-describedby":oe})},de=function(e){var o=e.theme,t=e.isInteractive,i=void 0===t?j.isInteractive:t,r=e.animate,n=void 0===r?j.animate:r,a=e.motionConfig,d=void 0===a?j.motionConfig:a,l=e.renderWrapper,c=R(e,re);return C(s,{isInteractive:i,animate:n,motionConfig:d,theme:o,renderWrapper:l,children:C(ae,O({isInteractive:i},c))})},le=function(e){return C(f,{children:function(o){var t=o.width,i=o.height;return C(de,O({width:t,height:i},e))}})};export{X as ResponsiveWaffle,le as ResponsiveWaffleCanvas,ie as ResponsiveWaffleHtml,U as Waffle,de as WaffleCanvas,te as WaffleHtml,j as canvasDefaultProps,B as commonDefaultProps,F as htmlDefaultProps,z as isDataCell,H as svgDefaultProps};
//# sourceMappingURL=nivo-waffle.es.js.map
