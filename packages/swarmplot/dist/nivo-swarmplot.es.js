import*as e from"react";import{useMemo as o,useCallback as i,createElement as t,Fragment as n,useRef as r,useState as a,useEffect as l}from"react";import{usePropertyAccessor as u,useValueFormatter as s,useMotionConfig as c,useTheme as d,Container as v,useDimensions as h,SvgWrapper as g,ResponsiveWrapper as f,getRelativeCursor as p,isCursorInRect as m}from"@nivo/core";import{Grid as y,Axes as x,renderGridLinesToCanvas as S,renderAxesToCanvas as M}from"@nivo/axes";import{Mesh as b,useVoronoiMesh as w,renderVoronoiToCanvas as C,renderVoronoiCellToCanvas as I}from"@nivo/voronoi";import{BasicTooltip as W,useTooltip as k}from"@nivo/tooltip";import{jsx as z,Fragment as B}from"react/jsx-runtime";import{useOrdinalColorScale as E,useInheritedColor as L}from"@nivo/colors";import{useAnnotations as V,Annotation as T}from"@nivo/annotations";import G from"lodash/isNumber";import H from"lodash/isPlainObject";import R from"lodash/isString";import F from"lodash/get";import{scaleOrdinal as j,scaleLinear as O}from"d3-scale";import{forceCollide as A,forceX as P,forceY as X,forceSimulation as Y}from"d3-force";import{generateSeriesAxis as D,computeScale as N,createDateNormalizer as q}from"@nivo/scales";import{useTransition as J,to as K,animated as Q}from"@react-spring/web";function U(){return U=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},U.apply(this,arguments)}function Z(e,o){if(null==e)return{};var i,t,n={},r=Object.keys(e);for(t=0;t<r.length;t++)i=r[t],o.indexOf(i)>=0||(n[i]=e[i]);return n}var $,_=function(e){var o=e.id,i=e.formattedValue,t=e.color;return z(W,{id:o,value:i,enableChip:!0,color:t})},ee={id:"id",value:"value",valueScale:{type:"linear",min:0,max:"auto"},groupBy:"group",size:6,spacing:2,layout:"vertical",gap:0,forceStrength:1,simulationIterations:120,colors:{scheme:"nivo"},colorBy:"group",borderWidth:0,borderColor:"rgba(0, 0, 0, 0)",layers:["grid","axes","circles","annotations","mesh"],enableGridX:!0,enableGridY:!0,axisTop:{},axisRight:{},axisBottom:{},axisLeft:{},isInteractive:!0,useMesh:!1,debugMesh:!1,tooltip:_,animate:!0,motionConfig:"gentle",annotations:[],role:"img",pixelRatio:"undefined"!=typeof window&&null!=($=window.devicePixelRatio)?$:1},oe=function(e){var o=e.width,i=e.height,t=e.axis,n=e.groups,r=e.gap;if(!Array.isArray(n)||0===n.length)throw new Error("'groups' should be an array containing at least one item");var a,l=n.length;"x"===t?a=(i-r*(l-1))/l:"y"===t&&(a=(o-r*(l-1))/l);var u=n.map((function(e,o){return o*(a+r)+a/2}));return j(u).domain(n)},ie=function(e){var o=e.width,i=e.height,t=e.axis,n=e.getValue,r=e.scale,a=e.data.map(n);if("time"===r.type){var l=[{data:a.map((function(e){var o;return{data:(o={x:null,y:null},o[t]=e,o)}}))}],u=D(l,t,r);return N(r,u,"x"===t?o:i,t)}var s=Math.min.apply(Math,a),c=Math.max.apply(Math,a);return N(r,{all:a,min:s,max:c},"x"===t?o:i,t)},te=function(e){if("function"==typeof e)return e;if(G(e))return function(){return e};if(H(e)){if(!R(e.key))throw new Error("Size is invalid, key should be a string pointing to the property to use to determine node size");if(!Array.isArray(e.values)||2!==e.values.length)throw new Error("Size is invalid, values spec should be an array containing two values, min and max");if(!Array.isArray(e.sizes)||2!==e.sizes.length)throw new Error("Size is invalid, sizes spec should be an array containing two values, min and max");var o=O().domain([e.values[0],e.values[1]]).range([e.sizes[0],e.sizes[1]]);return function(i){return o(F(i,e.key))}}throw new Error("Size is invalid, it should be either a function, a number or an object")},ne=function(e){var o,i,t=e.axis,n=e.valueScale,r=e.ordinalScale,a=e.spacing,l=e.forceStrength,u=A((function(e){return e.size/2+a/2}));if("x"===t)o=P((function(e){return n(e.value)})).strength(l),i=X((function(e){return r(e.group)}));else{if("y"!==t)throw new Error("Invalid axis provided: "+t);o=P((function(e){return r(e.group)})),i=X((function(e){return n(e.value)})).strength(l)}return{x:o,y:i,collision:u}},re=function(e){var o,i,t=e.data,n=e.getId,r=e.layout,a=e.getValue,l=e.valueScale,u=e.getGroup,s=e.ordinalScale,c=e.getSize,d=e.forces,v=e.simulationIterations,h=e.valueScaleConfig,g={horizontal:["x","y"],vertical:["y","x"]},f="time"===(i=h).type&&"native"!==i.format?q(i):function(e){return e},p=t.map((function(e){return{id:n(e),group:u(e),value:f(a(e)),size:c(e),data:U({},e)}})),m=Y(p).force("x",d.x).force("y",d.y).force("collide",d.collision).stop();return m.tick(v),(o={})[g[r][0]+"Scale"]=l,o[g[r][1]+"Scale"]=s,o.nodes=m.nodes(),o},ae=function(e){var i=e.width,t=e.height,n=e.axis,r=e.getValue,a=e.scale,l=e.data;return o((function(){return ie({width:i,height:t,axis:n,getValue:r,scale:a,data:l})}),[i,t,n,r,a,l])},le=function(e){var i=e.width,t=e.height,n=e.axis,r=e.groups,a=e.gap;return o((function(){return oe({width:i,height:t,axis:n,groups:r,gap:a})}),[i,t,n,r,a])},ue=function(e){var i=e.axis,t=e.valueScale,n=e.ordinalScale,r=e.spacing,a=e.forceStrength;return o((function(){return ne({axis:i,valueScale:t,ordinalScale:n,spacing:r,forceStrength:a})}),[i,t,n,r,a])},se=function(e){var i=e.data,t=e.width,n=e.height,r=e.id,a=e.value,l=e.valueFormat,c=e.valueScale,d=e.groups,v=e.groupBy,h=e.size,g=e.spacing,f=e.layout,p=e.gap,m=e.forceStrength,y=e.simulationIterations,x=e.colors,S=e.colorBy,M="horizontal"===f?"x":"y",b=u(r),w=u(a),C=s(l),I=u(v),W=function(e){return o((function(){return te(e)}),[e])}(h),k=u(S),z=E(x,k),B=ae({width:t,height:n,axis:M,getValue:w,scale:c,data:i}),L=le({width:t,height:n,axis:M,groups:d,gap:p}),V=ue({axis:M,valueScale:B,ordinalScale:L,spacing:g,forceStrength:m}),T=o((function(){return re({data:i,getId:b,layout:f,getValue:w,valueScale:B,getGroup:I,ordinalScale:L,getSize:W,forces:V,simulationIterations:y,valueScaleConfig:c})}),[i,b,f,w,B,I,L,W,V,y,c]),G=T.nodes,H=T.xScale,R=T.yScale;return{nodes:o((function(){return G.map((function(e){return U({},e,{formattedValue:C(e.value),color:z(e)})}))}),[G,C,z]),xScale:H,yScale:R,getColor:z}},ce=function(e){return o((function(){return"function"==typeof e?e:function(){return e}}),[e])},de=function(e){var o=e.isInteractive,t=e.onClick,n=e.onMouseEnter,r=e.onMouseLeave,a=e.onMouseMove,l=e.tooltip,u=k(),s=u.showTooltipFromEvent,c=u.hideTooltip;return{onMouseEnter:i((function(e,i){o&&(s(l(e),i),null==n||n(e,i))}),[o,n,s,l]),onMouseMove:i((function(e,i){o&&(s(l(e),i),null==a||a(e,i))}),[o,a,s,l]),onMouseLeave:i((function(e,i){o&&(c(),null==r||r(e,i))}),[o,c,r]),onClick:i((function(e,i){o&&(null==t||t(e,i))}),[o,t])}},ve=function(e){return{x:e.x,y:e.y}},he=function(e){return{size:e.size,width:e.size,height:e.size}},ge=function(e,o){return V({data:e,annotations:o,getPosition:ve,getDimensions:he})},fe=function(e){var i=e.nodes,t=e.xScale,n=e.yScale,r=e.innerWidth,a=e.innerHeight,l=e.outerWidth,u=e.outerHeight,s=e.margin;return o((function(){return{nodes:i,xScale:t,yScale:n,innerWidth:r,innerHeight:a,outerWidth:l,outerHeight:u,margin:s}}),[i,t,n,r,a,l,u,s])},pe=function(i){var n=i.nodes,r=i.borderWidth,a=i.borderColor,l=i.component,u=i.isInteractive,s=i.onMouseEnter,v=i.onMouseMove,h=i.onMouseLeave,g=i.onClick,f=i.tooltip,p=k(),m=p.showTooltipFromEvent,y=p.hideTooltip,x=o((function(){if(u)return function(e,o){m(t(f,e),o),null==s||s(e,o)}}),[u,m,f,s]),S=o((function(){if(u)return function(e,o){m(t(f,e),o),null==v||v(e,o)}}),[u,m,f,v]),M=o((function(){if(u)return function(e,o){y(),null==h||h(e,o)}}),[u,y,h]),b=o((function(){if(u)return function(e,o){null==g||g(e,o)}}),[u,g]),w=c(),C=w.animate,I=w.config,W=d(),E=ce(r),V=L(a,W),T=o((function(){return function(e){return{enter:function(o){return{x:o.x,y:o.y,radius:0,color:o.color,borderColor:e(o),opacity:0}},update:function(o){return{x:o.x,y:o.y,radius:o.size/2,color:o.color,borderColor:e(o),opacity:1}},leave:function(o){return{x:o.x,y:o.y,radius:0,color:o.color,borderColor:e(o),opacity:0}}}}(V)}),[V]),G=J(n,{keys:function(e){return e.id},initial:T.update,from:T.enter,enter:T.update,update:T.update,leave:T.leave,config:I,immediate:!C});return z(B,{children:G((function(o,i){return e.createElement(l,{key:i.id,node:i,style:U({},o,{radius:(t=o.radius,K([t],(function(e){return Math.max(0,e)}))),borderWidth:E(i)}),onMouseEnter:x,onMouseMove:S,onMouseLeave:M,onClick:b});var t}))})},me=function(e){var o=e.node,i=e.style,t=e.onMouseEnter,n=e.onMouseMove,r=e.onMouseLeave,a=e.onClick;return z(Q.circle,{cx:i.x,cy:i.y,r:i.radius,fill:i.color,stroke:i.borderColor,strokeWidth:i.borderWidth,opacity:i.opacity,onMouseEnter:function(e){return null==t?void 0:t(o,e)},onMouseMove:function(e){return null==n?void 0:n(o,e)},onMouseLeave:function(e){return null==r?void 0:r(o,e)},onClick:function(e){return null==a?void 0:a(o,e)}},o.id)},ye=function(e){var o=e.nodes,i=e.annotations,t=ge(o,i);return z(B,{children:t.map((function(e,o){return z(T,U({},e),o)}))})},xe=["nodes"],Se=["theme","isInteractive","animate","motionConfig","renderWrapper"],Me=function(e){var o=e.data,i=e.width,r=e.height,a=e.margin,l=e.id,u=void 0===l?ee.id:l,s=e.value,c=void 0===s?ee.value:s,d=e.valueScale,v=void 0===d?ee.valueScale:d,f=e.valueFormat,p=e.groups,m=e.groupBy,S=void 0===m?ee.groupBy:m,M=e.size,w=void 0===M?ee.size:M,C=e.forceStrength,I=void 0===C?ee.forceStrength:C,W=e.simulationIterations,k=void 0===W?ee.simulationIterations:W,B=e.colors,E=void 0===B?ee.colors:B,L=e.colorBy,V=void 0===L?ee.colorBy:L,T=e.borderColor,G=void 0===T?ee.borderColor:T,H=e.borderWidth,R=void 0===H?ee.borderWidth:H,F=e.layout,j=void 0===F?ee.layout:F,O=e.spacing,A=void 0===O?ee.spacing:O,P=e.gap,X=void 0===P?ee.gap:P,Y=e.layers,D=void 0===Y?ee.layers:Y,N=e.circleComponent,q=void 0===N?me:N,J=e.useMesh,K=void 0===J?ee.useMesh:J,Q=e.debugMesh,U=void 0===Q?ee.debugMesh:Q,$=e.enableGridX,_=void 0===$?ee.enableGridX:$,oe=e.gridXValues,ie=e.enableGridY,te=void 0===ie?ee.enableGridY:ie,ne=e.gridYValues,re=e.axisTop,ae=void 0===re?ee.axisTop:re,le=e.axisRight,ue=void 0===le?ee.axisRight:le,ce=e.axisBottom,ve=void 0===ce?ee.axisBottom:ce,he=e.axisLeft,ge=void 0===he?ee.axisLeft:he,Se=e.isInteractive,Me=e.onMouseEnter,be=e.onMouseMove,we=e.onMouseLeave,Ce=e.onClick,Ie=e.tooltip,We=void 0===Ie?ee.tooltip:Ie,ke=e.annotations,ze=void 0===ke?ee.annotations:ke,Be=e.role,Ee=void 0===Be?ee.role:Be,Le=h(i,r,a),Ve=Le.outerWidth,Te=Le.outerHeight,Ge=Le.margin,He=Le.innerWidth,Re=Le.innerHeight,Fe=se({width:He,height:Re,data:o,id:u,value:c,valueFormat:f,valueScale:v,groups:p,groupBy:S,size:w,spacing:A,layout:j,gap:X,colors:E,colorBy:V,forceStrength:I,simulationIterations:k}),je=Fe.nodes,Oe=Z(Fe,xe),Ae=Oe.xScale,Pe=Oe.yScale,Xe=de({isInteractive:Se,onClick:Ce,onMouseEnter:Me,onMouseLeave:we,onMouseMove:be,tooltip:We}),Ye={grid:null,axes:null,circles:null,annotations:null,mesh:null};D.includes("grid")&&(Ye.grid=z(y,{width:He,height:Re,xScale:_?Ae:null,xValues:oe,yScale:te?Pe:null,yValues:ne},"grid")),D.includes("axes")&&(Ye.axes=z(x,{xScale:Ae,yScale:Pe,width:He,height:Re,top:null!=ae?ae:void 0,right:null!=ue?ue:void 0,bottom:null!=ve?ve:void 0,left:null!=ge?ge:void 0},"axes")),D.includes("circles")&&(Ye.circles=z(pe,{nodes:je,borderWidth:R,borderColor:G,isInteractive:Se,tooltip:We,component:q,onMouseEnter:Me,onMouseMove:be,onMouseLeave:we,onClick:Ce},"circles")),D.includes("annotations")&&(Ye.annotations=z(ye,{nodes:je,annotations:ze},"annotations")),Se&&K&&(Ye.mesh=z(b,{nodes:je,width:He,height:Re,onMouseEnter:Xe.onMouseEnter,onMouseMove:Xe.onMouseMove,onMouseLeave:Xe.onMouseLeave,onClick:Xe.onClick,debug:U},"mesh"));var De=fe({nodes:je,xScale:Ae,yScale:Pe,innerWidth:He,innerHeight:Re,outerWidth:Ve,outerHeight:Te,margin:Ge});return z(g,{width:Ve,height:Te,margin:Ge,role:Ee,children:D.map((function(e,o){return void 0!==Ye[e]?Ye[e]:"function"==typeof e?z(n,{children:t(e,De)},o):null}))})},be=function(e){var o=e.theme,i=e.isInteractive,t=void 0===i?ee.isInteractive:i,n=e.animate,r=void 0===n?ee.animate:n,a=e.motionConfig,l=void 0===a?ee.motionConfig:a,u=e.renderWrapper,s=Z(e,Se);return z(v,{isInteractive:t,animate:r,motionConfig:l,theme:o,renderWrapper:u,children:z(Me,U({isInteractive:t},s))})},we=function(e){return z(f,{children:function(o){var i=o.width,t=o.height;return z(be,U({width:i,height:t},e))}})},Ce=["nodes"],Ie=["theme","isInteractive","animate","motionConfig","renderWrapper"],We=function(e,o){var i=o.node,t=o.getBorderWidth,n=o.getBorderColor,r=t(i);r>0&&(e.strokeStyle=n(i),e.lineWidth=r),e.beginPath(),e.arc(i.x,i.y,i.size/2,0,2*Math.PI),e.fillStyle=i.color,e.fill(),r>0&&e.stroke()},ke=function(e){var o=e.data,n=e.width,u=e.height,s=e.margin,c=e.id,v=void 0===c?ee.id:c,g=e.value,f=void 0===g?ee.value:g,y=e.valueFormat,x=e.valueScale,b=void 0===x?ee.valueScale:x,W=e.groups,B=e.groupBy,E=void 0===B?ee.groupBy:B,V=e.size,T=void 0===V?ee.size:V,H=e.forceStrength,R=void 0===H?ee.forceStrength:H,F=e.simulationIterations,j=void 0===F?ee.simulationIterations:F,O=e.colors,A=void 0===O?ee.colors:O,P=e.colorBy,X=void 0===P?ee.colorBy:P,Y=e.borderColor,D=void 0===Y?ee.borderColor:Y,N=e.layout,q=void 0===N?ee.layout:N,J=e.spacing,K=void 0===J?ee.spacing:J,Q=e.gap,U=void 0===Q?ee.gap:Q,$=e.layers,_=void 0===$?ee.layers:$,oe=e.renderCircle,ie=void 0===oe?We:oe,te=e.debugMesh,ne=void 0===te?ee.debugMesh:te,re=e.enableGridX,ae=e.gridXValues,le=e.enableGridY,ue=e.gridYValues,ce=e.axisTop,de=void 0===ce?ee.axisTop:ce,ve=e.axisRight,he=void 0===ve?ee.axisRight:ve,ge=e.axisBottom,fe=void 0===ge?ee.axisBottom:ge,pe=e.axisLeft,me=void 0===pe?ee.axisLeft:pe,ye=e.isInteractive,xe=e.onMouseMove,Se=e.onClick,Me=e.tooltip,be=void 0===Me?ee.tooltip:Me,we=e.role,Ie=void 0===we?ee.role:we,ke=e.pixelRatio,ze=void 0===ke?ee.pixelRatio:ke,Be=r(null),Ee=d(),Le=a(null),Ve=Le[0],Te=Le[1],Ge=h(n,u,s),He=Ge.outerWidth,Re=Ge.outerHeight,Fe=Ge.margin,je=Ge.innerWidth,Oe=Ge.innerHeight,Ae=se({width:je,height:Oe,data:o,id:v,value:f,valueFormat:y,valueScale:b,groups:W,groupBy:E,size:T,spacing:K,layout:q,gap:U,colors:A,colorBy:X,forceStrength:R,simulationIterations:j}),Pe=Ae.nodes,Xe=Z(Ae,Ce),Ye=Xe.xScale,De=Xe.yScale,Ne=w({points:Pe,width:je,height:Oe,debug:ne}),qe=Ne.delaunay,Je=Ne.voronoi,Ke=L(D,Ee),Qe=function(){return 1};l((function(){if(Be.current){Be.current.width=He*ze,Be.current.height=Re*ze;var e=Be.current.getContext("2d");e&&(e.scale(ze,ze),e.fillStyle=Ee.background,e.fillRect(0,0,He,Re),e.save(),e.translate(Fe.left,Fe.top),_.forEach((function(o){"grid"===o&&G(Ee.grid.line.strokeWidth)&&Ee.grid.line.strokeWidth>0&&(e.lineWidth=Ee.grid.line.strokeWidth,e.strokeStyle=Ee.grid.line.stroke,re&&S(e,{width:je,height:Oe,scale:Ye,axis:"x",values:ae}),le&&S(e,{width:je,height:Oe,scale:De,axis:"y",values:ue})),"axes"===o&&M(e,{xScale:Ye,yScale:De,width:je,height:Oe,top:de,right:he,bottom:fe,left:me,theme:Ee}),"circles"===o&&Pe.forEach((function(o){ie(e,{node:o,getBorderWidth:Qe,getBorderColor:Ke})})),"mesh"===o&&ne&&Je&&(C(e,Je),Ve&&I(e,Je,Ve.index))})))}}),[Be,He,Re,je,Oe,ze,Fe,Ee,_,Ye,De,re,ae,le,ue,de,he,fe,me,Je,ne,Ve,Pe,ie,Qe,Ke]);var Ue=i((function(e){if(!Be.current)return null;var o=p(Be.current,e),i=o[0],t=o[1];if(!m(Fe.left,Fe.top,je,Oe,i,t))return null;var n=qe.find(i-Fe.left,t-Fe.top);return Pe[n]}),[Be,Fe,je,Oe,qe,Pe]),Ze=k(),$e=Ze.showTooltipFromEvent,_e=Ze.hideTooltip,eo=i((function(e,o){$e(t(be,e),o)}),[$e,be]),oo=i((function(e){var o=Ue(e);Te(o),o?(null==xe||xe(o,e),eo(o,e)):_e()}),[Ue,Te,xe,eo,_e]),io=i((function(){_e(),Te(null)}),[_e,Te]),to=i((function(e){var o=Ue(e);o&&(null==Se||Se(o,e))}),[Ue,Se]);return z("canvas",{ref:Be,width:He*ze,height:Re*ze,style:{width:He,height:Re,cursor:ye?"auto":"normal"},role:Ie,onMouseEnter:ye?oo:void 0,onMouseMove:ye?oo:void 0,onMouseLeave:ye?io:void 0,onClick:ye?to:void 0})},ze=function(e){var o=e.theme,i=e.isInteractive,t=void 0===i?ee.isInteractive:i,n=e.animate,r=void 0===n?ee.animate:n,a=e.motionConfig,l=void 0===a?ee.motionConfig:a,u=e.renderWrapper,s=Z(e,Ie);return z(v,{isInteractive:t,animate:r,motionConfig:l,theme:o,renderWrapper:u,children:z(ke,U({isInteractive:t},s))})},Be=function(e){return z(f,{children:function(o){var i=o.width,t=o.height;return z(ze,U({width:i,height:t},e))}})};export{ke as InnerSwarmPlotCanvas,we as ResponsiveSwarmPlot,Be as ResponsiveSwarmPlotCanvas,be as SwarmPlot,ze as SwarmPlotCanvas,_ as SwarmPlotTooltip,ne as computeForces,re as computeNodes,oe as computeOrdinalScale,ie as computeValueScale,ee as defaultProps,te as getSizeGenerator,We as renderCircleDefault,ce as useBorderWidth,ue as useForces,de as useNodeMouseHandlers,le as useOrdinalScale,se as useSwarmPlot,ge as useSwarmPlotAnnotations,fe as useSwarmPlotLayerContext,ae as useValueScale};
//# sourceMappingURL=nivo-swarmplot.es.js.map
